machine:
  pre:
   - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.11.2
   - sudo pip install docker-compose
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - docker info

test:
  override:
    - docker-compose up -d ci; sleep 20
    - docker-compose run ci coverage run ./manage.py test
    - docker-compose run editor yarn lint:javascript
    - docker-compose run editor yarn unit
  post:
    - docker-compose run editor yarn coverage
